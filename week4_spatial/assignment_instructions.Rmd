---
title: "Week 4 Spatial analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F,message = F, eval = T)
```

## Setup

Copy and paste this code to set up:

```{r install packages, include =TRUE, eval= F}
install.packages(c("prism", "tigris" "raster", "rgdal"))


if(!dir.exists("Documents/EVS3000L")) {
dir.create("Documents/EVS3000L")
}
if(!dir.exists("Documents/EVS3000L/week4")) {
dir.create("Documents/EVS3000L/week4")
}
if(!dir.exists("Documents/EVS3000L/week4/prism")) {
dir.create("Documents/EVS3000L/week4/prism")
}
setwd("Documents/EVS3000L/week4")

```

```{r libraries}
library(dplyr)
library(ggplot2)
library(prism)
library(tigris)
library(rgdal)
```

```{r prism path local, include = F}
options(prism.path = here::here("week4_spatial", "prism"))
```

```{r prism path ufapps, eval = F}
options(prism.path = "Documents/EVS3000L/week4/prism")
```

## Download and load temperature and precipitation files

```{r download prism files}
get_prism_annual(type="ppt", years = c(1985, 2014), keepZip=FALSE)
get_prism_annual(type="tmean", years = c(1985, 2014), keepZip=FALSE)

prism_files <- ls_prism_data()
prism_dat <- prism_stack(prism_files)
names(prism_dat) <- c("precip_1985", "precip_2014", "temp_1985", "temp_2014")

```

## Plot temperature and precipitation data

```{r plot prism}

plot(prism_dat)

```

## Compute variable change

```{r compute change}

precip_change = prism_dat$precip_2014 - prism_dat$precip_1985
temp_change = prism_dat$temp_2014 - prism_dat$temp_1985

plot(precip_change)
plot(temp_change)

```

## Zoom in on a state


```{r get state boundaries}
states <- states(cb = T)

states <- states %>%
  dplyr::select(NAME)

```

```{r plot contiguous, echo = F}
plot(dplyr::filter(states,
                   NAME != "United States Virgin Islands",
              NAME != "Commonwealth of the Northern Mariana Islands",
              NAME != "Hawaii",
              NAME != "Guam",
              NAME != "American Samoa",
              NAME != "Alaska",
              NAME != "Puerto Rico"))

```

Fill in a state (or territory) of your choice. Here are your options - the text you fill in must match exactly.

```{r state options}

unique(states$NAME)

```

```{r choose a state}

my_state <- filter(states, NAME == "Florida")

plot(my_state)
```

## Plot precipitation and temperature change for that state

```{r plot state change}
library(raster)

my_state_temp_change <- crop(mask(temp_change, my_state[1,]), my_state[1,])

my_state_precip_change <- crop(mask(precip_change, my_state[1,]), my_state[1,])

plot(my_state_temp_change)

plot(my_state_precip_change)

```

## Compute mean variable change for that state

```{r mean change}

mean_temp_change =extract(my_state_temp_change, my_state[1,], fun = mean, na.rm = T)

mean_precip_change =extract(my_state_precip_change, my_state[1,], fun = mean, na.rm = T)

mean_temp_change

mean_precip_change

```


## Results to submit

* Which state (or territory) did you choose?
* Copy-paste the plots for precipitation and temperature change for that state or territory
* What were the mean values for temperature and precipitation change for that state?

Running this code will give you all of these results:

```{r results, echo = F}

print(paste0("State: ", my_state$NAME[1]))

plot(my_state_temp_change)

plot(my_state_precip_change)

print(paste0("Mean temperature change: ", mean_temp_change))

print(paste0("Mean precipitation change: ", mean_precip_change))

```

## Reflection questions